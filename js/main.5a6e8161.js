import{genres,searchAnime,getGenres}from"./api.0fccbd54.js";import{showLoader,hideLoader}from"./pages.53b77682.js";import{createFlashcard}from"./components/UIs.036b2cc4.js";import{escapeHTML,getSafeParams}from"./components/utils.89371d4e.js";import{loadDetailsPage}from"./components/details.7fb7fe83.js";export const status={searching:!1};export function initSlideshow(){let e=0;const t=document.querySelectorAll(".slide"),n=document.querySelector(".prev"),a=document.querySelector(".next");let s;function r(){t.forEach(e=>e.classList.remove("active")),e>=t.length&&(e=0),e<0&&(e=t.length-1),t[e].classList.add("active")}function i(){clearInterval(s),s=setInterval(()=>{e++,r()},5e3)}n&&a&&(n.addEventListener("click",()=>{e--,r(),i()}),a.addEventListener("click",()=>{e++,r(),i()}));const c=document.querySelector(".slideshow-container");let l=0,o=0;c.addEventListener("touchstart",e=>{l=e.changedTouches[0].screenX}),c.addEventListener("touchend",t=>{o=t.changedTouches[0].screenX,o<l&&(e++,r(),i()),o>l&&(e--,r(),i())}),r(),i()}export function initFlashcardHover(){function e(e){const t=e.querySelector(".flashcard-synopsis-overlay");t?(t.classList.add("fade-out"),t.addEventListener("transitionend",()=>{t.remove(),delete e.dataset.overlayAdded},{once:!0})):delete e.dataset.overlayAdded}function t(e){if(e.dataset.overlayAdded)return;e.dataset.overlayAdded="true";const t=e.dataset.synopsis,n=document.createElement("div");n.classList.add("flashcard-synopsis-overlay"),n.innerHTML=`\n      <p>${t}</p>\n      <a href="${e.href}" class="synopsis-details-link">...</a>\n    `,e.querySelector(".flashcard").appendChild(n)}document.querySelectorAll(".flashcard-link:not([data-hover-initialized])").forEach(n=>{"true"!=n.dataset.hoverInitialized&&(n.dataset.hoverInitialized="true",n.addEventListener("mouseenter",()=>t(n)),n.addEventListener("mouseleave",()=>e(n)),n.addEventListener("touchstart",()=>t(n)),n.addEventListener("touchend",()=>e(n)))})}export function initGalleryControls(){document.getElementById("content").addEventListener("click",e=>{const t=e.target.closest(".gallery-prev"),n=e.target.closest(".gallery-next");if(t){t.parentElement.querySelector(".horizontal-gallery").scrollBy({left:-400,behavior:"smooth"})}if(n){n.parentElement.querySelector(".horizontal-gallery").scrollBy({left:400,behavior:"smooth"})}})}export function randomAnime(){document.getElementById("random-anime-button").addEventListener("click",()=>{Math.floor(100*Math.random())<1?triggerJumpscare():window.location.hash="#/details-random"})}function triggerJumpscare(){const e=document.querySelector("header"),t=document.querySelector("main"),n=document.querySelector("footer"),a=document.getElementById("loader");e&&(e.style.display="none"),t&&(t.style.display="none"),n&&(n.style.display="none"),a&&(a.style.display="none");const s=document.createElement("div");s.id="jumpscare-container";const r=document.createElement("img");r.src="./media/jumpscare.jpg",r.id="jumpscare-image";const i=new Audio("./media/jumpscare.mp3");s.appendChild(r),document.body.appendChild(s),s.requestFullscreen&&s.requestFullscreen(),i.play().catch(e=>console.error("Couldn't play jumpscare audio, maybe it's missing?")),setTimeout(()=>{document.exitFullscreen&&document.exitFullscreen(),s.remove(),window.location.href="./"},3e3)}export const activeFilters={};export function initFilters(){const e=document.querySelector(".filter-button"),t=document.querySelector(".filter-options"),n=document.querySelectorAll(".filter-btn"),a=document.querySelectorAll(".filter-input"),s=document.querySelectorAll(".filter-dropdown");e.addEventListener("click",()=>{t.style.display="none"===t.style.display?"grid":"none"}),n.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.filter,n=e.dataset.value;["season","status","type","rating"].includes(t)?(document.querySelectorAll(`.filter-btn[data-filter="${t}"]`).forEach(e=>e.classList.remove("active")),activeFilters[t]!==n?(activeFilters[t]=n,e.classList.add("active")):delete activeFilters[t]):activeFilters[t]&&activeFilters[t].includes(n)?(activeFilters[t]=activeFilters[t].filter(e=>e!==n),activeFilters[t].length||delete activeFilters[t],e.classList.remove("active")):(activeFilters[t]||(activeFilters[t]=[]),activeFilters[t].push(n),e.classList.add("active"))})}),a.forEach(e=>{e.addEventListener("input",()=>{const t=e.id,n=e.value;n?activeFilters[t]=n:delete activeFilters[t]})}),s.forEach(e=>{e.addEventListener("change",()=>{const t=e.id,n=e.value;n?activeFilters[t]=n:delete activeFilters[t]})});document.getElementById("sfw-checkbox").addEventListener("change",()=>{activeFilters.sfw=!0})}export async function renderGenres(){"{}"===JSON.stringify(genres)&&await getGenres();const e=Object.entries(genres).map(([e,t])=>`\n        <button class="genre-btn" data-filter="genres" data-value="${e}">${t}</button>\n    `).join("");document.getElementById("genresDiv").innerHTML+=e,document.querySelectorAll(".genre-btn").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.filter,n=e.dataset.value;activeFilters[t]&&activeFilters[t].includes(n)?(activeFilters[t]=activeFilters[t].filter(e=>e!==n),activeFilters[t].length||delete activeFilters[t],e.classList.remove("active")):(activeFilters[t]||(activeFilters[t]=[]),activeFilters[t].push(n),e.classList.add("active"))})})}export async function initSearch(){applyFilters();const e=document.getElementById("search-button");e&&e.addEventListener("click",()=>{delete activeFilters.page,constructURL(!0)});const t=document.getElementById("search-input");t.addEventListener("input",()=>{activeFilters.q=t.value}),t.addEventListener("keypress",e=>{"Enter"===e.key&&(delete activeFilters.page,constructURL(!0))});getSafeParams().toString()&&handleSearch(!1)}async function handleSearch(e=!0){const t=await constructURL(e);if(t){displaySearchResults(await searchAnime(t))}}export async function constructURL(e=!1){const t=new URLSearchParams;for(const e in activeFilters){let n=activeFilters[e];"q"===e&&(n=n.replace(/[^\p{L}\p{N}\s\-_.:'"|#]/gu,"").slice(0,100)),Array.isArray(n)?t.append(e,n.join(",")):t.append(e,n)}if(!t.toString())return null;const n=`https://api.jikan.moe/v4/anime?${t.toString()}`;return e&&(window.location.hash=`#/search?${t.toString()}`),n}export function applyFilters(){for(const e in activeFilters)delete activeFilters[e];document.querySelectorAll('[class*="active"]').forEach(e=>e.classList.remove("active"));const e=getSafeParams(),t=["order_by","sort","min_score","max_score"];for(const[n,a]of e.entries())if("q"===n){const e=document.getElementById("search-input");e&&(e.value=a),activeFilters.q=a}else if("genres"===n)activeFilters[n]=[],a.split(",").forEach(e=>{const t=document.querySelector(`[data-filter='${n}'][data-value='${e}']`);t&&(t.classList.add("active"),activeFilters[n].push(e))});else if("page"===n)activeFilters[n]=a;else if(n in t){const e=document.getElementById(n);e&&(e.value=a)}else{const e=document.querySelector(`[data-filter='${n}'][data-value='${a}']`);e&&e.classList.add("active"),activeFilters[n]=a}}function loadPagination(e,t){if(!t)return;t.innerHTML="";const{current_page:n,last_visible_page:a,has_next_page:s}=e,r=(e,t,n)=>{const a=document.createElement("button");return a.innerHTML=e,a.disabled=!n,n&&a.addEventListener("click",()=>{const e=getSafeParams();e.set("page",t),window.location.hash=`#/search?${e.toString()}`}),a};t.appendChild(r("<<",1,n>1)),t.appendChild(r("<",n-1,n>1));const i=document.createElement("span");i.textContent=n,t.appendChild(i),t.appendChild(r(">",n+1,s)),t.appendChild(r(">>",a,n<a))}export async function displaySearchResults(e){const t=document.getElementById("search-results");if(!t)return;t.innerHTML="";const n=document.getElementById("default-search-content");if(n&&(n.style.display="none"),!e?.data?.length)return t.innerHTML='<p class="no-results">No Matching results found.</p>',status.searching=!1,void hideLoader();const a=document.createElement("h2");a.className="search-results-info",a.textContent=`Found ${e.pagination.items.total} results`,t.appendChild(a);const s=document.createElement("div");s.className="gridGallery",s.innerHTML=e.data.map(e=>createFlashcard(e,"top-rated")).join(""),t.appendChild(s);const r=document.createElement("div");r.className="pagination-controls",t.appendChild(r),initFlashcardHover(),loadPagination(e.pagination,r)}